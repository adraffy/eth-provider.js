function e(e=256){return new d(e,1)}function t(e=256){return new d(e,6)}function r(e){return new h(e,31)}function i(e){return[...e].map((e=>e.toString(16).padStart(2,"0"))).join("")}function s(e){if("string"!=typeof e)throw TypeError("expected string");e.startsWith("0x")&&(e=e.slice(2)),1&e.length&&(e=`0${e}`);let t=e.length>>1,r=new Uint8Array(t);for(let i=0,s=0;i<t;i++){let t=parseInt(e.slice(s,s+=2),16);if(Number.isNaN(t))throw new TypeError("expected hex byte");r[i]=t}return r}function n(e){if("string"!=typeof e)throw TypeError("expected string");try{e=unescape(encodeURIComponent(e))}catch(e){throw new Error("malformed utf8",{cause:e})}let{length:t}=e,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.charCodeAt(i);return r}function o(e){try{return decodeURIComponent(escape(String.fromCharCode(...e)))}catch(e){throw new Error("malformed utf8",{cause:e})}}class a{constructor(e,t){const r=1600;if(31&e)throw new Error("capacity % 32 != 0");if(e<0||e>=r)throw new Error("capacity must be [0,1600)");this.sponge=Array(50).fill(0),this.block_count=r-e>>5,this.block_index=0,this.suffix=t,this.ragged_block=0,this.ragged_shift=0}update(e){if(!(e instanceof Uint8Array))if(e instanceof ArrayBuffer)e=new Uint8Array(e);else if(Array.isArray(e))e=Uint8Array.from(e);else{if("string"!=typeof e)throw new TypeError("expected bytes");e=n(e)}let t=0,r=e.length;if(this.ragged_shift>0&&(t=this._add_ragged(e,0),t==r))return this;let{sponge:i,block_index:s,block_count:o}=this;for(;t+4<=r;t+=4)i[s++]^=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,s==o&&(u(i),s=0);return this.block_index=s,t<r&&this._add_ragged(e,t),this}_add_ragged(e,t){let{ragged_shift:r,ragged_block:i}=this,s=0;for(;t<e.length&&r<32;s++,t++,r+=8)i|=e[t]<<r;return 32==r&&(this._add_block(i),r=0,i=0),this.ragged_block=i,this.ragged_shift=r,s}_add_block(e){let{sponge:t,block_index:r,block_count:i}=this;t[r++]^=e,r==i&&(u(t),r=0),this.block_index=r}finalize(){let{sponge:e,suffix:t,ragged_shift:r,block_index:i,block_count:s}=this;if(r){if(-1==r)return;t=this.ragged_block|t<<r}e[i]^=t,e[s-1]^=2147483648,u(e),this.ragged_shift=-1}}class h extends a{constructor(e,t){super(e<<1,t),this.size0=e>>2,this.byte_offset=0}hex(e){return i(this.bytes(e))}bytes(e){this.finalize(),e||(e=this.size0);let{sponge:t,byte_offset:r,block_count:i}=this,s=3&r,n=(s>0)+(e+3>>2),o=new Int32Array(n),a=(r>>2)%i;for(let e=0;e<n;e++)o[e]=t[a++],a==i&&(u(t),a=0);return this.byte_offset=r+e,new Uint8Array(o.buffer,s,e)}}class d extends a{constructor(e,t){super(e<<1,t),this.size=e>>5}get hex(){return i(this.bytes)}get bytes(){this.finalize();let{size:e,sponge:t}=this,r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t[i];return new Uint8Array(r.buffer)}}const c=[1,0,32898,0,32906,-2147483648,-2147450880,-2147483648,32907,0,-2147483647,0,-2147450751,-2147483648,32777,-2147483648,138,0,136,0,-2147450871,0,-2147483638,0,-2147450741,0,139,-2147483648,32905,-2147483648,32771,-2147483648,32770,-2147483648,128,-2147483648,32778,0,-2147483638,-2147483648,-2147450751,-2147483648,32896,-2147483648,-2147483647,0,-2147450872,-2147483648];function u(e){for(let t=0;t<48;t+=2){let r=e[0]^e[10]^e[20]^e[30]^e[40],i=e[1]^e[11]^e[21]^e[31]^e[41],s=e[2]^e[12]^e[22]^e[32]^e[42],n=e[3]^e[13]^e[23]^e[33]^e[43],o=e[4]^e[14]^e[24]^e[34]^e[44],a=e[5]^e[15]^e[25]^e[35]^e[45],h=e[6]^e[16]^e[26]^e[36]^e[46],d=e[7]^e[17]^e[27]^e[37]^e[47],u=e[8]^e[18]^e[28]^e[38]^e[48],l=e[9]^e[19]^e[29]^e[39]^e[49],f=u^(s<<1|n>>>31),_=l^(n<<1|s>>>31);e[0]^=f,e[1]^=_,e[10]^=f,e[11]^=_,e[20]^=f,e[21]^=_,e[30]^=f,e[31]^=_,e[40]^=f,e[41]^=_,f=r^(o<<1|a>>>31),_=i^(a<<1|o>>>31),e[2]^=f,e[3]^=_,e[12]^=f,e[13]^=_,e[22]^=f,e[23]^=_,e[32]^=f,e[33]^=_,e[42]^=f,e[43]^=_,f=s^(h<<1|d>>>31),_=n^(d<<1|h>>>31),e[4]^=f,e[5]^=_,e[14]^=f,e[15]^=_,e[24]^=f,e[25]^=_,e[34]^=f,e[35]^=_,e[44]^=f,e[45]^=_,f=o^(u<<1|l>>>31),_=a^(l<<1|u>>>31),e[6]^=f,e[7]^=_,e[16]^=f,e[17]^=_,e[26]^=f,e[27]^=_,e[36]^=f,e[37]^=_,e[46]^=f,e[47]^=_,f=h^(r<<1|i>>>31),_=d^(i<<1|r>>>31),e[8]^=f,e[9]^=_,e[18]^=f,e[19]^=_,e[28]^=f,e[29]^=_,e[38]^=f,e[39]^=_,e[48]^=f,e[49]^=_;let w=e[0],p=e[1],y=e[11]<<4|e[10]>>>28,m=e[10]<<4|e[11]>>>28,E=e[20]<<3|e[21]>>>29,T=e[21]<<3|e[20]>>>29,C=e[31]<<9|e[30]>>>23,A=e[30]<<9|e[31]>>>23,g=e[40]<<18|e[41]>>>14,S=e[41]<<18|e[40]>>>14,b=e[2]<<1|e[3]>>>31,v=e[3]<<1|e[2]>>>31,O=e[13]<<12|e[12]>>>20,N=e[12]<<12|e[13]>>>20,R=e[22]<<10|e[23]>>>22,B=e[23]<<10|e[22]>>>22,L=e[33]<<13|e[32]>>>19,I=e[32]<<13|e[33]>>>19,P=e[42]<<2|e[43]>>>30,X=e[43]<<2|e[42]>>>30,x=e[5]<<30|e[4]>>>2,M=e[4]<<30|e[5]>>>2,D=e[14]<<6|e[15]>>>26,U=e[15]<<6|e[14]>>>26,H=e[25]<<11|e[24]>>>21,V=e[24]<<11|e[25]>>>21,G=e[34]<<15|e[35]>>>17,F=e[35]<<15|e[34]>>>17,k=e[45]<<29|e[44]>>>3,K=e[44]<<29|e[45]>>>3,Y=e[6]<<28|e[7]>>>4,Z=e[7]<<28|e[6]>>>4,q=e[17]<<23|e[16]>>>9,$=e[16]<<23|e[17]>>>9,W=e[26]<<25|e[27]>>>7,j=e[27]<<25|e[26]>>>7,z=e[36]<<21|e[37]>>>11,Q=e[37]<<21|e[36]>>>11,J=e[47]<<24|e[46]>>>8,ee=e[46]<<24|e[47]>>>8,te=e[8]<<27|e[9]>>>5,re=e[9]<<27|e[8]>>>5,ie=e[18]<<20|e[19]>>>12,se=e[19]<<20|e[18]>>>12,ne=e[29]<<7|e[28]>>>25,oe=e[28]<<7|e[29]>>>25,ae=e[38]<<8|e[39]>>>24,he=e[39]<<8|e[38]>>>24,de=e[48]<<14|e[49]>>>18,ce=e[49]<<14|e[48]>>>18;e[0]=w^~O&H,e[1]=p^~N&V,e[10]=Y^~ie&E,e[11]=Z^~se&T,e[20]=b^~D&W,e[21]=v^~U&j,e[30]=te^~y&R,e[31]=re^~m&B,e[40]=x^~q&ne,e[41]=M^~$&oe,e[2]=O^~H&z,e[3]=N^~V&Q,e[12]=ie^~E&L,e[13]=se^~T&I,e[22]=D^~W&ae,e[23]=U^~j&he,e[32]=y^~R&G,e[33]=m^~B&F,e[42]=q^~ne&C,e[43]=$^~oe&A,e[4]=H^~z&de,e[5]=V^~Q&ce,e[14]=E^~L&k,e[15]=T^~I&K,e[24]=W^~ae&g,e[25]=j^~he&S,e[34]=R^~G&J,e[35]=B^~F&ee,e[44]=ne^~C&P,e[45]=oe^~A&X,e[6]=z^~de&w,e[7]=Q^~ce&p,e[16]=L^~k&Y,e[17]=I^~K&Z,e[26]=ae^~g&b,e[27]=he^~S&v,e[36]=G^~J&te,e[37]=F^~ee&re,e[46]=C^~P&x,e[47]=A^~X&M,e[8]=de^~w&O,e[9]=ce^~p&N,e[18]=k^~Y&ie,e[19]=K^~Z&se,e[28]=g^~b&D,e[29]=S^~v&U,e[38]=J^~te&y,e[39]=ee^~re&m,e[48]=P^~x&q,e[49]=X^~M&$,e[0]^=c[t],e[1]^=c[t+1]}}function l(e,t){let r=e.length,i=r-t.length;for(let s=0;0==i&&s<r;s++)i=e[s]-t[s];return i}function f(t){if("string"!=typeof t)throw new TypeError("expected string");if(t.startsWith("0x")&&(t=t.slice(2)),t=t.toLowerCase(),!/^[a-f0-9]{40}$/.test(t))throw new TypeError("expected 40-char hex");let r=e().update(t).hex;return"0x"+[...t].map(((e,t)=>r.charCodeAt(t)>=56?e.toUpperCase():e)).join("")}function _(e){return/^(0x)?[a-f0-9]{40}$/i.test(e)}function w(e){try{return f(e)===e}catch(e){}}function p(e){return/^(0x)?[0]+$/i.test(e)}function y(e){try{let t=bytes_from_base58(e);return t.length>=2&&t.length==2+t[1]}catch(e){return!1}}function m(e){if(y(e))return`ipfs://${e}`;let t;return(t=e.match(/^ipfs\:\/\/ipfs\/(.*)$/i))?`ipfs://${t[1]}`:e}class E{static wrap(e){if(e instanceof E)return e;if(e instanceof Uint8Array)return new this(A(v,32,!1));if(Number.isSafeInteger(e))return this.from_number(e);if("string"==typeof e)return this.from_str(e);throw new TypeError(`not Uint256-like: ${e}`)}static zero(){return new this(new Uint8Array(32))}static from_number(e){return this.zero().set_number(e)}static from_bytes(e){return new this(A(e,32))}static from_str(e){return e.startsWith("0x")?this.from_hex(e):this.from_dec(e)}static from_hex(e){return this.from_bytes(s(e))}static from_dec(e){if(!/^[0-9]+$/.test(e))throw new TypeError(`expected decimal digits: ${e}`);let t=e.length;t<10&&this.from_number(parseInt(e,10));let r=new Uint8Array(Math.max(32,t)),i=0;for(let s=0;s<t;s++){let t=e.charCodeAt(s)-48;for(let e=0;e<i;e++)t+=10*r[e],r[e]=t,t>>=8;for(;t>0;)r[i++]=t,t>>=8}for(let e=Math.min(i,15);e>=0;e--){let t=31-e,i=r[e];r[e]=r[t],r[t]=i}return new this(r.slice(0,32))}constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("expected bytes");if(32!=e.length)throw new TypeError("expected 32 bytes");this.bytes=e}clone(){return new this.constructor(this.bytes.slice())}compare(e){return l(this.bytes,this.constructor.wrap(e).bytes)}set_number(e){return C(this.bytes,e),this}add(e){let t=this.constructor.wrap(e).bytes,{bytes:r}=this,i=0;for(let e=31;e>=0;e--){let s=r[e]+t[e]+i;r[e]=s,i=s>>8}return this}not(){return this.bytes.forEach(((e,t,r)=>r[t]=~e)),this}get number(){let{bytes:e}=this;return 255==e[0]?-(1+T(e.map((e=>~e)))):T(e)}get unsigned(){return T(this.bytes)}get hex(){return"0x"+i(this.bytes)}get dec(){return this.digit_str(10)}digit_str(e,t="0123456789abcdefghjiklmnopqrstuvwxyz"){if(e>t.length)throw new RangeError(`radix larger than lookup: ${x}`);return this.digits(e).map((e=>t[e])).join("")}digits(e){if(e<2)throw new RangeError(`radix must be 2 or more: ${e}`);let t=[0];for(let r of this.bytes){for(let i=0;i<t.length;++i){let s=t[i]<<8|r;t[i]=s%e,r=s/e|0}for(;r>0;)t.push(r%e),r=r/e|0}return t.reverse()}toJSON(){return this.hex}toString(){return`Uint256(${this.hex})`}}function T(e){if(e.length>7){let t=e.length-7;for(let r=0;r<t;r++)if(e[r]>0)throw new RangeError("overflow");e=e.subarray(t)}let t=0;for(let r of e)t=256*t+r;if(!Number.isSafeInteger(t))throw new RangeError("overflow");return t}function C(e,t){if(!Number.isSafeInteger(t))throw new RangeError(`expected integer: ${t}`);if(t<0){t=-(t+1);for(let r=e.length-1;r>=0;r--)e[r]=~(255&t),t=Math.floor(t/256)}else for(let r=e.length-1;r>=0;r--)e[r]=255&t,t=Math.floor(t/256)}function A(e,t,r=!0){let{length:i}=e;if(i==t)return r?e.slice():e;if(i>t)return e.slice(t-i);let s=new Uint8Array(t);return s.set(e,t-i),s}class g{static from_hex(e){return new this(s(e))}constructor(e){this.buf=e,this.pos=0}get remaining(){return this.buf.length-this.pos}read_bytes(e){let{pos:t,buf:r}=this,i=t+e;if(i>r.length)throw new RangeError("buffer overflow");let s=r.subarray(t,i);return this.pos=i,s}read_memory(){let e=this.number(),t=e+32,{buf:r}=this;if(t>r.length)throw new RangeError("buffer overflow");let i=T(r.subarray(e,t));if(e=t,t+=i,t>r.length)throw new RangeError("buffer overflow");return r.subarray(e,t)}read_byte(){let{pos:e,buf:t}=this;if(e>=t.length)throw new RangeError("buffer overflow");return this.pos=e+1,t[e]}bytes(e){return this.read_bytes(e).slice()}boolean(){return this.number()>0}number(e=32){return T(this.read_bytes(e))}uint256(){return new E(this.bytes(32))}string(){return o(this.read_memory())}memory(){return this.read_memory().slice()}addr(e=!0){if(this.read_bytes(12).some((e=>e>0)))throw new TypeError("invalid address: expected zero");let t=i(this.read_bytes(20));return e?f(t):`0x${t}`}uvarint(){let e=0,t=1;for(;;){let r=this.read_byte();if(e+=(127&r)*t,r<=127)break;if(t>70368744177664)throw new RangeException("overflow");t*=128}return e}}function S(t){if(t.includes("("))return e().update(t).bytes.subarray(0,4);try{let e=t instanceof Uint8Array?t:s(t);if(4!=e.length)throw new Error("expected 4 bytes");return e}catch(e){throw new Error(`method ${t} should be a signature or 8-char hex`)}}class b{static method(e){return new b(4).add_bytes(S(e))}constructor(e=0,t=256){if(!Number.isSafeInteger(t)||t<1)throw new TypeError("expected positive initial capacity");this.buf=new Uint8Array(t),this.pos=0,this.offset=e,this.tails=[]}reset(){return this.buf.fill(0),this.tails.length=0,this.pos=0,this}build_hex(){return"0x"+i(this.build())}build(){let{pos:e,tails:t,offset:r}=this,i=t.reduce(((e,[t,r])=>r.length),0);if(i>0){this.alloc(i);let{buf:s}=this;for(let[i,n]of t)C(s.subarray(i,i+32),e-r),s.set(n,e),e+=n.length}return this.buf.subarray(0,e)}alloc(e){if(!Number.isSafeInteger(e)||e<1)throw new TypeError("expected positive size");let{buf:t,pos:r}=this,i=r+e;if(i>t.length){let r=new Uint8Array(Math.max(t.length+e,t.length<<1));r.set(t),this.buf=t=r}return this.pos=i,t.subarray(r,i)}bytes_hex(e){return this.bytes(s(e))}bytes(e){return this.alloc(e.length+31&-32).set(e),this}number(e,t=32){if(e instanceof E){let r=this.alloc(t);t<32?r.set(e.bytes.subarray(32-t)):r.set(e.bytes,t-32)}else C(this.alloc(t),e);return this}string(e){return this.memory(n(e))}memory(e){let{pos:t}=this;this.alloc(32);let r=new Uint8Array(e.length+63&-32);return C(r.subarray(0,32),e.length),r.set(e,32),this.tails.push([t,r]),this}addr(e){let t=s(e);if(20!=t.length)throw new TypeError("expected address");return this.alloc(32).set(t,12),this}add_hex(e){return this.add_bytes(s(e))}add_bytes(e){if(!(e instanceof Uint8Array))if(e instanceof ArrayBuffer)e=new Uint8Array(e);else{if(!Array.isArray(e))throw new TypeError("expected bytes");e=Uint8Array.from(e)}return this.alloc(e.length).set(e),this}}const O="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";function N(e){let t=[],r=0;for(let i of e)if(0!=t.length||0!=i){for(let e=0;e<t.length;++e){let r=t[e]<<8|i;t[e]=r%58,i=r/58|0}for(;i>0;)t.push(i%58),i=i/58|0}else r++;for(;r>0;r--)t.push(0);return String.fromCharCode(...t.reverse().map((e=>O.charCodeAt(e))))}function R(e){if("string"!=typeof e)throw new TypeError("expected string");let t=new Uint8Array(e.length),r=0,i=0;for(let s of e){let e=O.indexOf(s);if(e<0)throw new TypeError("expected base58 string");if(0==i){if(0==e){r++;continue}i=1}for(let r=0;r<i;r++)e+=58*t[r],t[r]=e,e>>=8;for(;e>0;)t[i++]=e,e>>=8}i+=r;for(let e=0,r=i-1;e<r;e++,r--){let i=t[e];t[e]=t[r],t[r]=i}return t.subarray(0,i)}async function B(e){return parseInt(await e.request({method:"eth_chainId"}))}async function L(e){let t=e.source?.();return t||(e.isMetaMask?"MetaMask":"Unknown")}function I(e){if("string"==typeof e&&(e=parseInt(e)),!Number.isSafeInteger(e))throw new TypeError(`expected chain: ${e}`);return e}class P{static from_map(e){if("object"!=typeof e)throw new TypeError("expected object");let t=new P;for(let[r,i]of Object.entries(e))t.add_static(r,i);return t}constructor({cooldown:e=3e4}={}){this.queue=[],this.cooldown=e}add_static(e,t){return e=I(e),this.queue.some((e=>e.provider===t))||this.queue.push({chain_id:e,provider:t}),this}add_dynamic(e){if(!this.queue.some((t=>t.provider===e))){let t={provider:e,chain_id:null},r=e=>{t.chain_id=parseInt(e)};t.handler=r,e.on("connect",r),e.on("chainChanged",r),this.queue.unshift(t)}return this}disconnect(){for(let{provider:e}of this.queue)e.disconnect?.()}async find_provider(e,t=!1,r=!0){if(void 0!==e&&!Number.isSafeInteger(e))throw new TypeError(`expected chain_id integer: ${e}`);r&&await Promise.all(this.queue.filter((e=>null===e.chain_id)).map((async e=>{try{e.chain_id=await B(e.provider)}catch(t){e.chain_id=!1,e.cooldown=setTimeout((()=>{e.chainId=null}),this.cooldown)}})));let i=this.queue.find((t=>t.chain_id===e));if(!i&&t)throw new Error(`No provider for chain ${e}`);return i?.provider}view(e){e=I(e);let t=async(...t)=>this.find_provider(e,...t);return new Proxy(this,{get:(e,r)=>{switch(r){case"isProviderView":return!0;case"get_provider":return t;default:return e[r]}}})}}async function X({fix:e=!0,timeout:t=5e3}={}){return new Promise(((r,i)=>{let s,n;const o="ethereum#initialized";function a(){let t=globalThis.ethereum;if(t)return r(e?D(t):t),!0}a()||(s=setTimeout((()=>{globalThis?.removeEventListener(o,n),a()||i(new Error("No window.ethereum"))}),0|t),n=()=>{clearTimeout(s),globalThis?.removeEventListener(o,n),a()||i(new Error("jebaited"))},globalThis?.addEventListener(o,n))}))}function M(e){return-32e3===e.code&&"header not found"===e.message}function D(e,{retry:t=2,delay:r=1e3}={}){if("number"!=typeof t||t<1)throw new TypeError("expected retry > 0");if("number"!=typeof r||r<0)throw new TypeError("expected delay >= 0");if(e)return new Proxy(e,{get:function(e,t){return"request"===t?i:e[t]}});async function i(r){try{return await e.request(r)}catch(i){if(!M(i))throw i;let s=t;for(;;)try{await e.request({method:"eth_chainId"});break}catch(e){if(!M(e)&&0==--s)throw i}return e.request(r)}}}class U{constructor(){this.__events={}}emit(e,...t){let r=this.__events[e];if(!r)return!1;for(let e of r)e(...t);return!0}on(e,t){let r=this.__events[e];return r||(this.__events[e]=r=[]),r.push(t),this}removeListener(e,t){let r=this.__events[e];if(r){let i=r.indexOf(t);i>=0&&(r.splice(i,1),0==r.length&&delete this.__events[e])}return this}}class H extends U{constructor({url:e,WebSocket:t,request_timeout:r=3e4,idle_timeout:i=6e4}){if("string"!=typeof e)throw new TypeError("expected url");if(t||(t=globalThis.WebSocket),!t)throw new Error("unknown WebSocket implementation");super(),this.url=e,this._ws_api=t,this._request_timeout=r,this._idle_timeout=i,this._idle_timer=void 0,this._ws=void 0,this._terminate=void 0,this._reqs=void 0,this._subs=new Set,this._id=void 0,this._chain_id=void 0}source(){return this.url}get idle_timeout(){return this._idle_timeout}set idle_timeout(e){this.idle_timeout=0|e,this._restart_idle()}disconnect(){this._terminate?.(new Error("Forced disconnect"))}_restart_idle(){if(clearTimeout(this._idle_timer),this._idle_timeout>0&&0==this._subs.size&&0==Object.keys(this._reqs).length){const{_terminate:e}=this;this._idle_timer=setTimeout((()=>{e(new Error("Idle timeout"))}),this._idle_timeout)}}async request(e){if("object"!=typeof e)throw new TypeError("expected object");let{method:t,params:r}=e;if("string"!=typeof t)throw new Error("expected method");if(r&&!Array.isArray(r))throw new Error("expected params array");switch(await this.ensure_connected(),t){case"eth_chainId":return this._chain_id;case"eth_subscribe":return this._request(e).then((e=>(this._subs.add(e),clearTimeout(this._idle_timer),e)));case"eth_unsubscribe":return this._request(e).then((e=>(this._subs.delete(r[0]),this._restart_idle(),e)));default:return this._request(e)}}_request(e){const t=++this._id,{_reqs:r,_ws:i,_request_timeout:s}=this;return clearTimeout(this._idle_timer),new Promise(((n,o)=>{let a=s>0?setTimeout((()=>{delete r[t],this._restart_idle(),o(new Error("Timeout"))}),s):void 0;r[t]={timer:a,ful:n,rej:o},i.send(JSON.stringify({jsonrpc:"2.0",id:t,...e}))}))}async ensure_connected(){let{_ws:e}=this;if(Array.isArray(e))return new Promise(((t,r)=>{e.push({ful:t,rej:r})}));if(e)return;const t=this._ws=[],r=new this._ws_api(this.url);try{await new Promise(((e,t)=>{this._terminate=t;let i=setTimeout((()=>t(new Error("Timeout"))),this._request_timeout);r.addEventListener("close",t),r.addEventListener("error",t),r.addEventListener("open",(()=>{r.removeEventListener("error",t),r.removeEventListener("close",t),clearTimeout(i),e()}))}))}catch(e){r.close(),this._ws=void 0,this._terminate=void 0;for(let{rej:r}of t)r(e);throw this.emit("connect-error",e),e}this._ws=r,this._id=0;let i,s=this._reqs={},n=this._terminate=e=>{r.removeEventListener("close",i),r.removeEventListener("error",n),r.close(),this._ws=void 0,this._terminate=void 0,this._reqs=void 0,this._id=void 0,this._chain_id=void 0,this._subs.clear(),clearTimeout(this._idle_timer);for(let{rej:t}of Object.values(s))t(e);this.emit("disconnect",e)};i=()=>n(new Error("Unexpected close")),r.addEventListener("close",i),r.addEventListener("error",n),r.addEventListener("message",(({data:e})=>{let t=JSON.parse(e),{id:r}=t;if(void 0===r){let{method:e,params:{subscription:r,result:i}}=t;this.emit("message",{type:e,data:{subscription:r,result:i}})}else{let e=s[r];if(!e)return;delete s[t.id],clearTimeout(e.timer),this._restart_idle();let{result:i,error:n}=t;if(i)return e.ful(i);let o=new Error(n?.message??"Unknown Error");"code"in n&&(o.code=n.code),e.rej(o)}})),this._chain_id=await this._request({method:"eth_chainId"}),this.emit("connect",this._chain_id);for(let{ful:e}of t)e()}}class V extends U{constructor({url:e,fetch:t,request_timeout:r=3e4,idle_timeout:i=6e4}){if("string"!=typeof e)throw new TypeError("expected url");if(!t){let e=globalThis.fetch;if(!e)throw new TypeError("unable to find fetch()");t=e.bind(globalThis)}super(),this.url=e,this._fetch_api=t,this._id=0,this._chain_id=void 0,this._request_timeout=0|r,this._idle_timeout=0|i,this._idle_timer=void 0}source(){return this.url}async request(e){if("object"!=typeof e)throw new TypeError("expected object");if(!this._idle_timer){let e=2,t=1e3;for(;;)try{this._chain_id=await this._request({method:"eth_chainId"});break}catch(r){if(e>0&&M(r)){await new Promise((e=>setTimeout(e,t))),e--;continue}throw this.emit("connect-error",r),r}this.emit("connect",this._chain_id),this._restart_idle()}switch(e.method){case"eth_chainId":return this._chain_id;case"eth_subscribe":case"eth_unsubscribe":throw new Error(`${e.method} not supported by FetchProvider`)}try{let t=await this._request(e);return this._restart_idle(),t}catch(e){throw this._terminate(e),e}}_restart_idle(){clearTimeout(this._idle_timer),this._idle_timer=!(this._idle_timeout>0)||setTimeout((()=>{this._terminate(new Error("Idle timeout"))}),this._idle_timeout)}disconnect(){this._idle_timer&&this._terminate(new Error("Forced disconnect"))}_terminate(e){this.emit("disconnect",e),clearTimeout(this._idle_timer),this._idle_timer=void 0,this._chain_id=void 0}_fetch(e,...t){return this._fetch_api(this.url,{method:"POST",body:JSON.stringify({...e,jsonrpc:"2.0",id:++this._id}),cache:"no-store",...t})}async _request(e){let t,r;if(this._request_timeout>0){let r=new AbortController,i=setTimeout((()=>r.abort()),this._request_timeout);try{t=await this._fetch(e,{signal:r.signal})}finally{clearTimeout(i)}}else t=await this._fetch(e);if(200!==t.status)throw new Error(`Fetch failed: ${t.status}`);try{r=await t.json()}catch(e){throw new Error("Invalid provider response: expected json",{cause:e})}let{error:i}=r;if(!i)return r.result;let s=new Error(i.message??"unknown error");throw s.code=i.code,s}}async function G(e,t,r=null,i="latest"){if("object"!=typeof e)throw new TypeError("expected provider");"string"==typeof t&&(t={to:t}),r instanceof b&&(t.data=r.build_hex());try{let r=await e.request({method:"eth_call",params:[t,i]});return g.from_hex(r)}catch(e){throw-32e3==e.code&&"execution reverted"===e.message&&(e.reverted=!0),e}}async function F(e,t,r){return(await G(e,t,b.method("01ffc9a7").bytes(S(r)))).boolean()}var k={777:833,3333:333333,BTC:0,LTC:2,DOGE:3,RDD:4,DASH:5,PPC:6,NMC:7,FTC:8,XCP:9,BLK:10,NSR:11,NBT:12,MZC:13,VIA:14,XCH:8444,RBY:16,GRS:17,DGC:18,CCN:828,DGB:20,MONA:22,CLAM:23,XPM:24,NEOS:25,JBS:26,ZRC:27,VTC:28,NXT:29,BURST:30,MUE:31,ZOOM:32,VASH:33,CDN:34,SDC:35,PKB:36,PND:37,START:38,MOIN:39,EXP:40,EMC2:41,DCR:42,XEM:43,PART:44,ARG:45,SHR:48,GCR:49,NVC:50,AC:51,BTCD:52,DOPE:53,TPC:54,AIB:55,EDRC:56,SYS:57,SLR:58,SMLY:59,ETH:60,ETC:61,PSB:62,LDCN:63,XBC:65,IOP:66,NXS:67,INSN:68,OK:69,BRIT:70,CMP:71,CRW:72,BELA:73,ICX:74,FJC:75,MIX:76,XVG:77,EFL:78,CLUB:79,RICHX:80,POT:81,QRK:82,TRC:83,GRC:84,AUR:85,IXC:86,NLG:87,BITB:88,BTA:1657,XMY:90,BSD:91,UNO:92,MTR:18e3,GB:94,SHM:95,CRX:96,BIQ:97,EVO:98,STO:99,BIGUP:100,GAME:101,DLC:102,ZYD:103,DBIC:104,STRAT:105,SH:106,MARS:107,UBQ:108,PTC:109,NRO:110,ARK:111,USC:112,THC:113,LINX:114,ECN:115,DNR:116,PINK:117,ATOM:118,PIVX:119,FLASH:120,ZEN:121,PUT:122,ZNY:123,UNIFY:124,XST:125,BRK:126,VC:127,XMR:128,VOX:129,NAV:130,FCT:7777777,EC:132,ZEC:133,LSK:134,STEEM:135,XZC:136,RBTC:137,RPT:139,LBC:140,KMD:141,BSQ:142,RIC:143,XRP:144,BCH:145,NEBL:146,ZCL:147,XLM:148,NLC2:149,WHL:150,ERC:151,DMD:152,BTM:153,BIO:154,XWCC:155,BTG:156,BTC2X:157,SSN:158,TOA:159,BTX:160,ACC:161,BCO:5249353,ELLA:163,PIRL:164,NANO:256,VIVO:166,FRST:167,HNC:168,BUZZ:169,MBRS:170,HC:171,HTML:172,ODN:173,ONX:174,RVN:175,GBX:176,BTCZ:177,POA:178,NYC:179,MXT:180,WC:181,MNX:182,BTCP:183,MUSIC:184,BCA:185,CRAVE:186,STAK:187,WBTC:188,LCH:189,EXCL:190,LCC:192,XFE:193,EOS:194,TRX:195,KOBO:196,HUSH:197,BANANO:198,ETF:199,OMNI:200,BIFI:201,UFO:202,CNMC:203,BCN:204,RIN:205,ATP:206,EVT:207,ATN:208,BIS:209,NEET:210,BOPO:211,OOT:212,ALIAS:213,MONK:842,BOXY:215,FLO:216,MEC:217,BTDX:218,XAX:219,ANON:220,LTZ:221,BITG:222,ICP:223,SMART:224,XUEZ:225,HLM:226,WEB:227,ACM:228,NOS:229,BITC:230,HTH:231,TZC:232,VAR:233,IOV:234,FIO:235,BSV:236,DXN:237,QRL:238,PCX:239,LOKI:240,NIM:242,SOV:243,JCT:244,SLP:245,EWT:246,UC:401,EXOS:248,ECA:249,SOOM:250,XRD:1022,FREE:252,NPW:253,BST:254,BTCC:257,ZEST:259,ABT:260,PION:261,DT3:262,ZBUX:263,KPL:264,TPAY:265,ZILLA:266,ANK:267,BCC:268,HPB:269,ONE:1023,SBC:271,IPC:272,DMTC:273,OGC:274,SHIT:275,ANDES:276,AREPA:277,BOLI:278,RIL:279,HTR:280,FCTID:281,BRAVO:282,ALGO:283,BZX:284,GXX:285,HEAT:286,XDN:287,FSN:288,CPC:337,BOLD:290,IOST:291,TKEY:292,USE:293,BCZ:294,IOC:295,ASF:296,MASS:297,FAIR:298,NUKO:299,GNX:300,DIVI:301,CMT:1122,EUNO:303,IOTX:304,ONION:305,"8BIT":306,ATC:307,BTS:308,CKB:309,UGAS:310,ADS:311,ARA:312,ZIL:313,MOAC:314,SWTC:315,VNSC:316,PLUG:317,MAN:318,ECC:319,RPD:320,RAP:321,GARD:322,ZER:323,EBST:324,SHARD:325,LINDA:326,CMM:327,BLOCK:328,AUDAX:329,LUNA:330,ZPM:331,KUVA:332,MEM:333,CS:498,SWIFT:335,FIX:336,VGO:338,DVT:339,N8V:340,MTNS:341,BLAST:342,DCT:343,AUX:344,USDP:345,HTDF:346,YEC:347,QLC:348,TEA:349,ARW:350,MDM:351,CYB:352,LTO:353,DOT:354,AEON:355,RES:356,AYA:357,DAPS:358,CSC:359,VSYS:360,NOLLAR:361,XNOS:362,CPU:363,LAMB:364,VCT:365,CZR:366,ABBC:367,HET:368,XAS:369,VDL:370,MED:371,ZVC:372,VESTX:373,DBT:374,SEOS:375,MXW:376,ZNZ:377,XCX:378,SOX:379,NYZO:380,ULC:381,RYO:88888,KAL:383,XSN:384,DOGEC:385,BMV:386,QBC:387,IMG:388,QOS:389,PKT:390,LHD:391,CENNZ:392,HSN:393,CRO:394,UMBRU:395,TON:607,NEAR:397,XPC:398,ZOC:399,NIX:400,GALI:402,OLT:403,XBI:404,DONU:405,EARTHS:406,HDD:407,SUGAR:408,AILE:409,TENT:410,TAN:411,AIN:412,MSR:413,SUMO:414,ETN:415,BYTZ:416,WOW:417,XTNC:418,LTHN:419,NODE:420,AGM:421,CCX:422,TNET:423,TELOS:424,AION:425,BC:426,KTV:427,ZCR:428,ERG:429,PESO:430,BTC2:431,XRPHD:432,WE:433,KSM:434,PCN:435,NCH:436,ICU:437,LN:438,DTP:439,BTCR:1032,AERGO:441,XTH:442,LV:443,PHR:444,VITAE:445,COCOS:446,DIN:447,SPL:448,YCE:449,XLR:450,KTS:556,DGLD:452,XNS:453,EM:454,SHN:455,SEELE:456,AE:457,ODX:458,KAVA:459,GLEEC:476,FIL:461,RUTA:462,CSDT:463,ETI:464,ZSLP:465,ERE:466,DX:467,CPS:468,BTH:469,MESG:470,FIMK:471,AR:472,OGO:473,ROSE:474,BARE:475,CLR:477,RNG:478,OLO:479,PEXA:480,MOON:481,OCEAN:482,BNT:483,AMO:484,FCH:485,LAT:486,COIN:487,VEO:488,CCA:489,GFN:490,BIP:491,KPG:492,FIN:493,BAND:494,DROP:495,BHT:496,LYRA:497,RUPX:499,THETA:500,SOL:501,THT:502,CFX:503,KUMA:504,HASH:505,CSPR:506,EARTH:507,ERD:508,CHI:509,KOTO:510,OTC:511,SEELEN:513,AETH:514,DNA:515,VEE:516,SIERRA:517,LET:518,BSC:9006,BTCV:520,ABA:521,SCC:522,EDG:523,AMS:524,GOSS:525,BU:526,GRAM:527,YAP:528,SCRT:529,NOVO:530,GHOST:531,HST:532,PRJ:533,YOU:534,XHV:535,BYND:536,JOYS:537,VAL:616,FLOW:539,SMESH:540,SCDO:541,IQS:542,BIND:543,COINEVO:544,SCRIBE:545,HYN:546,BHP:547,BBC:1111,MKF:549,XDC:550,STR:551,SUM:997,HBC:553,BCS:555,LKR:557,TAO:558,XWC:559,DEAL:560,NTY:561,TOP:562,STARS:563,AG:564,CICO:565,IRIS:566,NCG:567,LRG:568,SERO:569,BDX:570,CCXX:571,SLS:572,SRM:573,VLX:574,VIVT:575,BPS:576,NKN:577,ICL:578,BONO:579,PLC:580,DUN:581,DMCH:582,CTC:583,KELP:584,GBCR:585,XDAG:586,PRV:587,SCAP:588,TFUEL:589,GTM:590,RNL:591,GRIN:592,MWC:593,DOCK:594,POLYX:595,DIVER:596,XEP:597,APN:598,TFC:599,UTE:600,MTC:601,NC:602,XINY:603,DYN:3381,BUFS:605,STOS:606,TAFT:608,HYDRA:609,NOR:610,WCN:613,OPT:614,PSWAP:615,XOR:617,SSP:618,DEI:619,AXL:620,ZERO:621,NOBL:624,EAST:625,LORE:628,BTSG:639,LFC:640,AZERO:643,XLN:646,ZRB:648,UCO:650,PIRATE:660,SFRX:663,ACT:666,PRKL:667,SSC:668,GC:669,YUNGE:677,Voken:678,Evrynet:680,KAR:686,CET:688,VEIL:698,XDAI:700,MCOIN:707,CHC:711,XTL:713,BNB:714,SIN:715,DLN:716,MCX:725,BMK:731,ATOP:737,RAD:747,XPRT:750,BALLZ:768,COSA:770,BR:771,BTW:777,UIDD:786,ACA:787,BNC:788,TAU:789,BEET:800,DST:3564,QVT:808,DVPN:811,VET:818,CLO:820,BDB:822,CRUZ:831,SAPP:832,KYAN:834,AZR:835,CFL:836,DASHD:837,TRTT:838,UCR:839,PNY:840,BECN:841,SAGA:843,SUV:844,ESK:845,OWO:846,PEPS:847,BIR:848,DSM:852,PRCY:853,MOB:866,IF:868,LUM:880,ZBC:883,ADF:886,NEO:888,TOMO:889,XSEL:890,LKSC:896,XEC:1899,LMO:900,HNT:904,FIS:907,SAAGE:909,META:916,FRA:917,DIP:925,RUNE:931,LTP:955,MATIC:966,TWINS:970,XAZAB:988,AIOZ:989,PEC:991,OKT:996,LBTC:1776,BCD:999,BTN:1e3,TT:1001,BKT:1002,NODL:1003,FTM:1007,HT:1010,ELV:1011,BIC:1013,EVC:1020,ONT:1024,KEX:1026,MCM:1027,RISE:1120,ETSC:1128,DFI:1129,CDY:1145,HOO:1170,ALPH:1234,MOVR:1285,DFC:1337,HYC:1397,TENTSLP:1410,BEAM:1533,ELF:1616,AUDL:1618,ATH:1620,NEW:1642,BCX:1688,XTZ:1729,BBP:1777,JPYS:1784,VEGA:1789,ADA:1815,TES:1856,CLC:1901,VIPS:1919,CITY:1926,XX:1955,XMX:1977,TRTL:1984,EGEM:1987,HODL:1989,PHL:1990,SC:1991,MYT:1996,POLIS:1997,XMCC:1998,COLX:1999,GIN:2e3,MNP:2001,KIN:2017,EOSC:2018,GBT:2019,PKC:2020,SKT:2021,XHT:2022,MCASH:2048,TRUE:2049,IoTE:2112,XRG:2137,ASK:2221,QTUM:2301,ETP:2302,GXC:2303,CRP:2304,ELA:2305,SNOW:2338,AOA:2570,REOSC:2894,LUX:3003,XHB:3030,COS:3077,SEQ:3383,DEO:3552,NAS:2718,BND:2941,CCC:3276,ROI:3377,FC8:4040,YEE:4096,IOTA:4218,AXE:4242,XYM:4343,FIC:5248,HNS:5353,FUND:5555,STX:5757,VOW:5895,SLU:5920,GO:6060,MOI:6174,BPA:6666,SAFE:19165,ROGER:6969,TOPL:7091,BTV:7777,SKY:8e3,PAC:8192,KLAY:8217,BTQ:8339,SBTC:8888,NULS:8964,BTP:8999,AVAX:9e3,ARB:9001,BOBA:9002,LOOP:9003,STARK:9004,AVAXC:9005,NRG:9797,BTF:9888,GOD:9999,FO:1e4,RTM:10226,XRC:10291,XPI:10605,ESS:11111,IPOS:12345,MINA:12586,BTY:13107,YCC:13108,SDGO:15845,XTX:16181,ARDR:16754,FLUX:19167,RITO:19169,XND:20036,PWR:22504,BELL:25252,CHX:25718,ESN:31102,TEO:33416,BTCS:33878,BTT:34952,FXTC:37992,AMA:39321,AXIV:43028,EVE:49262,STASH:49344,CELO:52752,KETH:65536,GRLC:69420,GWL:70007,ZYN:77777,WICC:99999,HOME:100500,STC:101010,STRAX:105105,AKA:200625,GENOM:200665,ATS:246529,PI:314159,VALUE:333332,X42:424242,VITE:666666,SEA:888888,ILT:1171337,ETHO:1313114,XERO:1313500,LAX:1712144,EPK:3924011,HYD:4741444,BHD:5249354,PTN:5264462,WAN:5718350,WAVES:5741564,SEM:7562605,ION:7567736,WGR:7825266,OBSR:7825267,AFS:8163271,XDS:15118976,AQUA:61717561,HATCH:88888888,kUSD:91927009,GENS:99999996,EQ:99999997,FLUID:99999998,QKC:99999999,FVDC:608589380};function K(t){return new E(e().update(t).bytes)}function Y(t){if("string"!=typeof t)throw new TypeError("expected string");let r=new Uint8Array(64);if(t.length>0)for(let i of t.split(".").reverse())r.set(K(i).bytes,32),r.set(e().update(r).bytes,0);return new E(r.slice(0,32))}class Z{constructor({provider:e,providers:t,ens_normalize:r,registry:i="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"}){if(!e)throw new Error("expected provider");if(this.provider=e,e.isProviderView)this.providers=e;else if(t){if(!(t instanceof P))throw new Error("invalid providers");this.providers=t}else{let t=new P;t.add_dynamic(e),this.providers=t}this.ens_normalize=r,this.registry=i,this.normalizer=void 0,this.eth=void 0}normalize(e){return this.ens_normalize?.(e)??e}async get_provider(){let e=this.provider;return e.isProviderView?e.get_provider():e}async get_resolver(e){return(await G(await this.get_provider(),this.registry,b.method("0178b8bf").number(e))).addr()}async resolve(e,{is_address:t,throws:r=!1}={}){void 0===t&&(t=_(e));let i=new q(this,e,t);try{await i.resolve_input()}catch(e){if(r)throw e}return i}async is_dot_eth_available(e){this.eth||(this.eth=await this.resolve("eth",{throws:!0}));return(await G(await this.get_provider(),await this.eth.get_address(),b.method("96e494e8").number(K(e)))).boolean()}}class q{constructor(e,t,r){this.ens=e,this.input=t,this._is_address=r}toJSON(){return this.name}assert_input_error(){if(this._error)throw new Error(this._error)}assert_valid_resolver(){if(this.assert_input_error(),!this.resolver)throw new Error("Null resolver")}async resolve_input(){if(this._error=void 0,this.name=void 0,this.node=void 0,this.primary=void 0,this.owner=void 0,this.address=void 0,this._display=void 0,this.avatar=void 0,this.pubkey=void 0,this.content=void 0,this.resolver=void 0,this.resolved=void 0,this.text={},this.addr={},this._is_address){try{this.address=f(this.input)}catch(e){throw new Error(this._error=`Invalid address: ${e.message}`)}let e;try{e=await this.get_primary()}catch(e){throw this._error=e.message,e}if(!e)throw new Error(this._error=`No name for ${this.input}`);try{this.name=this.ens.normalize(e)}catch(t){throw new Error(this._error=`Primary name is invalid: ${e}`,{cause:t})}}else try{this.name=this.ens.normalize(this.input)}catch(e){throw new Error(this._error=`Input name is invalid: ${this.input}`,{cause:e})}this.node=Y(this.name);try{let e=await this.ens.get_resolver(this.node);p(e)||(this.resolver=e)}catch(e){throw new Error(this._error="Unable to determine resolver",{cause:e})}return this.resolved=new Date,this}async get_address(){if(this.address)return this.address;this.assert_valid_resolver();try{const e="3b3b57de";return this.address=(await G(await this.ens.get_provider(),this.resolver,b.method(e).number(this.node))).addr()}catch(e){throw new Error(`Read address failed: ${e.message}`,{cause:e})}}async get_owner(){if(this.owner)return this.owner;this.assert_input_error();try{const e="02571be3";return this.owner=(await G(await this.ens.get_provider(),this.ens.registry,b.method(e).number(this.node))).addr()}catch(e){throw new Error(`Read owner failed: ${e.message}`,{cause:e})}}async get_primary(){if(void 0!==this.primary)return this.primary;this.assert_input_error();let e=Y(`${(await this.get_address(!0)).slice(2).toLowerCase()}.addr.reverse`),t=await this.ens.get_resolver(e);if(p(t))this.primary=null;else try{const r="691f3431";this.primary=(await G(await this.ens.get_provider(),t,b.method(r).number(e))).string()}catch(e){throw new Error(`Lookup primary failed: ${e.message}`,{cause:e})}return this.primary}get input_error(){return this._error}is_input_address(){return this._is_address}is_input_norm(){return!this._is_address&&this.input===this.name}validate_name(e){let t;this.assert_input_error();try{t=this.ens.normalize(e)}catch(t){throw new Error(`${e} name is invalid: ${t.message}`,{cause:t})}if(t!==this.name)throw new Error(`${e||"(empty-string)"} does not match ${this.name}`);return e}async is_input_display(){if(this._is_address)return!1;let e;this.resolver&&(e=await this.get_text("display"));try{if(!e)return this.input===this.name;if(this.input===e)return this.validate_name(e),!0}catch(e){}return!1}async get_display_name(){if(this._display)return this._display;let e=await this.get_text("display"),t=this.name;try{t=this.validate_name(e)}catch(e){}return this._display=t}async get_avatar(){return this.avatar?this.avatar:this.avatar=await $(await this.get_text("avatar"),this.ens.providers,await this.get_address())}async get_text(e){return this.get_texts([e]).then((t=>t[e]))}async get_texts(e,t){if(!Array.isArray(e))throw new TypeError("expected array");this.assert_valid_resolver();let r=await this.ens.get_provider();if(await Promise.all(e.flatMap((e=>e in this.text?[]:(async()=>{try{this.text[e]=(await G(r,this.resolver,b.method("59d1d43c").number(this.node).string(e))).string()}catch(t){throw delete this.text[e],new Error(`Error reading text ${e}: ${t.message}`,{cause:t})}})()))),!t)return this.text;for(let r of e)t[r]=this.text[r];return t}async get_addr(e){return this.get_addrs([e]).then((t=>t[e]))}async get_addrs(e,t,r=!0){if(!Array.isArray(e))throw new TypeError("expected array");this.assert_valid_resolver(),e=e.map(W);let i=await this.ens.get_provider();if(await Promise.all(e.flatMap((([e,t])=>e in this.addr?[]:(async()=>{try{const e="f1cb7e06";let r=(await G(i,this.resolver,b.method(e).number(this.node).number(t))).memory();this.addr[t]=r}catch(r){throw delete this.addr[t],new Error(`Error reading addr ${e}: ${r.message}`,{cause:r})}})()))),t){for(let[i,s]of e)t[r?i:s]=this.addr[s];return t}return r?Object.fromEntries(Object.entries(this.addr).map((([e,t])=>{let[r]=W(parseInt(e));return[r,t]}))):this.addr}async get_pubkey(){if(this.assert_valid_resolver(),this.pubkey)return this.pubkey;if(p(this.resolver))return this.pubkey={};try{const e="c8690233";let t=await G(await this.ens.get_provider(),this.resolver,b.method(e).number(this.node));return this.pubkey={x:t.uint256(),y:t.uint256()}}catch(e){throw new Error(`Error reading pubkey: ${e.message}`,{cause:e})}}async get_content(){if(this.assert_valid_resolver(),this.content)return this.content;try{const e="bc1c58d1";let t=(await G(await this.ens.get_provider(),this.resolver,b.method(e).number(this.node))).memory(),r={};if(t.length>0){r.hash=t;let e=new g(t);227==e.uvarint()&&1==e.read_byte()&&112==e.read_byte()&&(r.url=`ipfs://${N(e.read_bytes(e.remaining))}`)}return this.content=r}catch(e){throw new Error(`Error reading content: ${e.message}`,{cause:e})}}}async function $(e,t,r){if("string"!=typeof e)throw new Error("Invalid avatar: expected string");if(0==e.length)return{type:"null"};if(e.includes("://")||e.startsWith("data:"))return{type:"url",url:e};let i=e.split("/"),s=i[0];if(s.startsWith("eip155:")){if(i.length<2)return{type:"invalid",error:"expected contract"};if(i.length<3)return{type:"invalid",error:"expected token"};let e=parseInt(s.slice(s.indexOf(":")+1));if(!(e>0))return{type:"invalid",error:"expected chain id"};let n=i[1];if(n.startsWith("erc721:")){let s,o=n.slice(n.indexOf(":")+1);if(!_(o))return{type:"invalid",error:"expected contract address"};o=f(o);try{s=E.from_str(i[2])}catch(e){return{type:"invalid",error:"expected uint256 token"}}let a={type:"nft",interface:"erc721",contract:o,token:s,chain_id:e};if(t instanceof P&&(t=await(t?.find_provider(e))),t)try{const e="c87b56dd",i="6352211e";let[n,h]=await Promise.all([G(t,o,b.method(i).number(s)).then((e=>e.addr())),G(t,o,b.method(e).number(s)).then((e=>e.string()))]);a.owner=n,a.meta_uri=h,r&&(a.owned=r.toUpperCase()===n.toUpperCase()?1:0)}catch(e){return{type:"invalid",error:"invalid response from contract"}}return a}if(n.startsWith("erc1155:")){let s,o=n.slice(n.indexOf(":")+1);if(!_(o))return{type:"invalid",error:"invalid contract address"};o=f(o);try{s=E.from_str(i[2])}catch(e){return{type:"invalid",error:"expected uint256 token"}}let a={type:"nft",interface:"erc1155",contract:o,token:s,chain_id:e};if(t instanceof P&&(t=await(t?.find_provider(e))),t)try{const e="0e89341c",i="00fdd58e";let[n,h]=await Promise.all([r?G(t,o,b.method(i).addr(r).number(s)).then((e=>e.number())):-1,G(t,o,b.method(e).number(s)).then((e=>e.string()))]);a.meta_uri=h.replace("{id}",s.hex.slice(2)),r&&(a.owned=n)}catch(e){return{type:"invalid",error:"invalid response from contract"}}return a}return{type:"invalid",error:`unsupported contract interface: ${n}`}}return{type:"unknown"}}function W(e){if("string"==typeof e){let t=k[e];if("number"!=typeof t)throw new Error(`Unknown address type for name: ${e}`);return[e,t]}if("number"==typeof e){let t,r=Object.values(k).indexOf(e);return t=r>=0?Object.keys(k)[r]:"0x"+e.toString(16).padStart(4,"0"),[t,e]}throw new TypeError("Expected address type or name")}class j{constructor(e,t,{strict:r=!0,cache:i=!0}={}){this.provider=e,this.address=f(t),this.type=void 0,this.type_error=void 0,this.strict=r,this.queue=[],i&&(this.token_uris={})}async get_provider(){let e=this.provider;return e.isProviderView?e.get_provider():e}async get_type(){let{queue:e}=this;if(!e){if(this.type_error)throw new Error("Type resolution failed",{cause:this.type_error});return this.type}if(0!=e.length)return new Promise(((t,r)=>{e.push({ful:t,rej:r})}));try{let t;return t=await F(await this.get_provider(),this.address,"d9b67a26")?"ERC-1155":!this.strict||await F(await this.get_provider(),this.address,"80ac58cd")?"ERC-721":"Unknown",this.type=t,this.queue=void 0,e.forEach((e=>e.ful())),t}catch(t){throw this.type_error=t,this.queue=void 0,e.forEach((e=>e.rej(t))),t}}async get_token_uri(e){let t=E.wrap(e),{hex:r}=t,{token_uris:i}=this,s=i?.[r];if(!s){switch(await this.get_type()){case"ERC-721":{const e="c87b56dd";s=(await G(await this.get_provider(),this.address,b.method(e).add_hex(r))).string();break}case"ERC-1155":{const e="0e89341c";s=(await G(await this.get_provider(),this.address,b.method(e).add_hex(r))).string(),s=s.replace("{id}",r.slice(2));break}default:throw new Error(`unable to query ${e} from ${this.address}`)}s=m(s),i&&(i[r]=s)}return s}}export{g as ABIDecoder,b as ABIEncoder,k as ADDR_TYPES,Z as ENS,q as ENSName,V as FetchProvider,j as NFT,P as Providers,E as Uint256,H as WebSocketProvider,N as base58_from_bytes,S as bytes4_from_method,R as bytes_from_base58,s as bytes_from_hex,n as bytes_from_utf8,B as chain_id_from_provider,f as checksum_address,l as compare_arrays,X as determine_window_provider,G as eth_call,m as fix_multihash_uri,i as hex_from_bytes,w as is_checksum_address,M as is_header_bug,y as is_multihash,p as is_null_hex,_ as is_valid_address,e as keccak,K as labelhash,A as left_truncate_bytes,Y as namehash,$ as parse_avatar,D as retry,C as set_bytes_to_number,t as sha3,r as shake,L as source_from_provider,F as supports_interface,T as unsigned_from_bytes,o as utf8_from_bytes};
